<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notícias do Brasil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-balance {
                text-wrap: balance;
            }
        }
    </style>
    <style>
        /* CSS variables for theming. Default to 'finance' theme. */
        :root {
            --bg-color: #165129;
            --text-main: #f4f4f8;
            --text-secondary: #FCBE2B;
            --highlight-color: #2BB34E;
            --card-bg-color: rgba(0, 0, 0, 0.3);
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            transition: background-color 0.5s, color 0.5s;
        }
        .news-card {
            background-color: var(--card-bg-color);
            border-left: 4px solid var(--highlight-color);
            transition: background-color 0.5s, border-left-color 0.5s;
        }
        .news-card-source, .news-card-time {
            color: var(--text-secondary);
            transition: color 0.5s;
        }
    </style>
    <!-- O RSS Parser não é mais necessário, a busca é feita via JSON -->
</head>
<body class="font-sans overflow-hidden">
    <!-- Container principal para as notícias, usando Grid para o layout dos cartões -->
    <div id="news-feed" class="p-10 grid grid-cols-3 grid-rows-2 gap-8 h-screen w-screen">
        <!-- Loader inicial, será substituído pelas notícias -->
        <div id="loader" class="col-span-3 row-span-2 flex items-center justify-center">
            <p class="text-3xl animate-pulse" style="color: var(--text-secondary)">Carregando notícias...</p>
        </div>
        <!-- Os cartões de notícia serão injetados aqui pelo JavaScript -->
    </div>

    <script>
        // --- CONFIGURAÇÕES DE TEMA ---
        const themes = {
            finance: {
                '--bg-color': '#165129',
                '--text-main': '#f4f4f8',
                '--text-secondary': '#FCBE2B',
                '--highlight-color': '#2BB34E',
                '--card-bg-color': 'rgba(0, 0, 0, 0.3)',
            },
            dark: {
                '--bg-color': '#1f2937', // gray-800
                '--text-main': '#f9fafb', // gray-50
                '--text-secondary': '#9ca3af', // gray-400
                '--highlight-color': '#3b82f6', // blue-500
                '--card-bg-color': 'rgba(55, 65, 81, 0.5)', // gray-700 with opacity
            },
            light: {
                '--bg-color': '#f3f4f6', // gray-100
                '--text-main': '#111827', // gray-900
                '--text-secondary': '#6b7280', // gray-500
                '--highlight-color': '#3b82f6', // blue-500
                '--card-bg-color': 'rgba(255, 255, 255, 1)', // white
            }
        };

        function applyTheme(themeName) {
            const theme = themes[themeName] || themes.finance; // Padrão para 'finance'
            const root = document.documentElement;
            for (const [key, value] of Object.entries(theme)) {
                root.style.setProperty(key, value);
            }
        }

        function getThemeFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('theme');
        }

        // Aplica o tema ao carregar a página
        applyTheme(getThemeFromURL());

        // --- CONFIGURAÇÕES DE NOTÍCIAS ---
        const NEWS_JSON_URL = 'news.json';
        const MAX_ITEMS = 6;
        const REFRESH_INTERVAL_MINUTES = 5;
        // --- FIM DAS CONFIGURAÇÕES ---

        const newsFeedElement = document.getElementById('news-feed');

        async function fetchNews() {
            console.log(`Buscando notícias de ${NEWS_JSON_URL}...`);
            try {
                const response = await fetch(`${NEWS_JSON_URL}?t=${new Date().getTime()}`);
                if (!response.ok) {
                    throw new Error(`Erro HTTP! status: ${response.status}`);
                }
                const news = await response.json();
                console.log("Notícias recebidas com sucesso:", news);
                displayNews(news);
            } catch (err) {
                console.error('Erro ao buscar notícias:', err);
                displayError('Não foi possível carregar as notícias. Verifique a fonte de dados.');
            }
        }

        function displayError(message) {
            newsFeedElement.innerHTML = `
                <div class="col-span-3 row-span-2 flex items-center justify-center">
                    <p class="text-3xl text-center" style="color: var(--text-secondary)">${message}</p>
                </div>`;
        }

        function displayNews(news) {
            if (!news || news.length === 0) {
                displayError("Nenhuma notícia encontrada na fonte de dados.");
                return;
            }

            newsFeedElement.innerHTML = ''; // Limpa o conteúdo anterior

            news.slice(0, MAX_ITEMS).forEach(item => {
                const newsCardHTML = `
                    <div class="news-card flex flex-col justify-between p-8 rounded-2xl shadow-2xl backdrop-blur-sm">
                        <div>
                            <p class="news-card-source text-2xl font-semibold mb-4">${item.source}</p>
                            <h2 class="text-5xl font-bold leading-tight text-balance">${item.title}</h2>
                        </div>
                        <p class="news-card-time text-xl mt-6">${new Date(item.timestamp).toLocaleString('pt-BR')}</p>
                    </div>
                `;
                newsFeedElement.innerHTML += newsCardHTML;
            });
            console.log("Notícias carregadas e HTML atualizado.");
        }

        // Carrega as notícias ao iniciar
        fetchNews();

        // Atualiza as notícias periodicamente
        if (REFRESH_INTERVAL_MINUTES > 0) {
            setInterval(fetchNews, REFRESH_INTERVAL_MINUTES * 60 * 1000);
        }
    </script>
</body>
</html>
