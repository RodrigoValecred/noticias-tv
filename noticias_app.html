<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notícias do Brasil</title>
    <script src="https://cdn.tailwindcss.com?plugins=line-clamp"></script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-balance {
                text-wrap: balance;
            }
        }
    </style>
    <style>
        /* CSS variables for theming. Default to 'finance' theme. */
        :root {
            --bg-color: #165129;
            --text-main: #f4f4f8;
            --text-secondary: #FCBE2B;
            --highlight-color: #2BB34E;
            --card-bg-color: rgba(0, 0, 0, 0.3);
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            transition: background-color 0.5s, color 0.5s;
        }
        .news-item {
            opacity: 0;
            transition: opacity 0.75s ease-in-out;
            will-change: opacity;
        }
        .news-item.visible {
            opacity: 1;
        }
    </style>
    <!-- O RSS Parser não é mais necessário, a busca é feita via JSON -->
</head>
<body class="font-sans overflow-hidden">
    <!-- Container de tela cheia para o carrossel de notícias -->
    <div id="news-container" class="w-screen h-screen flex items-center justify-center p-12">
        <!-- Loader inicial, será substituído pela notícia -->
        <div id="loader">
            <p class="text-4xl animate-pulse" style="color: var(--text-secondary)">Carregando notícias...</p>
        </div>
        <!-- A notícia será injetada aqui pelo JavaScript -->
    </div>

    <script>
        // --- CONFIGURAÇÕES DE TEMA ---
        const themes = {
            finance: { '--bg-color': '#165129', '--text-main': '#f4f4f8', '--text-secondary': '#FCBE2B' },
            dark: { '--bg-color': '#1f2937', '--text-main': '#f9fafb', '--text-secondary': '#9ca3af' },
            light: { '--bg-color': '#f3f4f6', '--text-main': '#111827', '--text-secondary': '#6b7280' }
        };

        function applyTheme(themeName) {
            const theme = themes[themeName] || themes.finance;
            const root = document.documentElement;
            Object.entries(theme).forEach(([key, value]) => root.style.setProperty(key, value));
        }

        applyTheme(new URLSearchParams(window.location.search).get('theme'));

        // --- CONFIGURAÇÕES DO CARROSSEL E NOTÍCIAS ---
        const NEWS_JSON_URL = 'news.json';
        const NEWS_REFRESH_INTERVAL_MINUTES = 15;
        const CAROUSEL_INTERVAL_SECONDS = 15;
        // --- FIM DAS CONFIGURAÇÕES ---

        const newsContainer = document.getElementById('news-container');
        const loader = document.getElementById('loader');

        let newsList = [];
        let currentNewsIndex = 0;
        let carouselIntervalId = null;

        function updateNewsDisplay(newsItem) {
            const currentElement = newsContainer.querySelector('.news-item');
            if (currentElement) {
                currentElement.classList.remove('visible');
            }

            setTimeout(() => {
                if (!newsItem) {
                    newsContainer.innerHTML = '';
                    return;
                }
                const newsHTML = `
                    <div class="news-item text-center max-w-6xl">
                        <p class="text-4xl font-semibold mb-8" style="color: var(--text-secondary)">${newsItem.source}</p>
                        <h1 class="text-6xl font-bold leading-tight text-balance line-clamp-4">${newsItem.title}</h1>
                        <p class="text-3xl mt-10" style="color: var(--text-secondary)">${new Date(newsItem.timestamp).toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
                    </div>
                `;
                newsContainer.innerHTML = newsHTML;
                const newElement = newsContainer.querySelector('.news-item');
                if (newElement) {
                    void newElement.offsetWidth; // Force reflow for transition
                    newElement.classList.add('visible');
                }
            }, 750); // Match CSS transition
        }

        function startCarousel() {
            if (carouselIntervalId) clearInterval(carouselIntervalId);
            if (newsList.length === 0) return;

            updateNewsDisplay(newsList[currentNewsIndex]);

            carouselIntervalId = setInterval(() => {
                currentNewsIndex = (currentNewsIndex + 1) % newsList.length;
                updateNewsDisplay(newsList[currentNewsIndex]);
            }, CAROUSEL_INTERVAL_SECONDS * 1000);
        }

        async function fetchNews() {
            console.log(`Buscando notícias...`);
            try {
                const response = await fetch(`${NEWS_JSON_URL}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const fetchedNews = await response.json();
                if (fetchedNews.length > 0) {
                    loader.style.display = 'none';
                    newsList = fetchedNews;
                    // Se o carrossel já estiver rodando, ele continuará com a lista antiga até o próximo ciclo de atualização de notícias.
                    // Para uma atualização imediata, podemos reiniciar o carrossel:
                    if (!carouselIntervalId) {
                         startCarousel();
                    }
                } else if (newsList.length === 0) { // Apenas mostra erro se não tiver notícias antigas para exibir
                    displayError("Nenhuma notícia encontrada.");
                }
            } catch (err) {
                console.error('Erro ao buscar notícias:', err);
                if (newsList.length === 0) displayError('Falha ao carregar notícias.');
            }
        }

        function displayError(message) {
            loader.style.display = 'none';
            newsContainer.innerHTML = `<p class="text-4xl text-center" style="color: var(--text-secondary)">${message}</p>`;
        }

        // Initial fetch
        fetchNews();
        // Periodically fetch new news
        setInterval(fetchNews, NEWS_REFRESH_INTERVAL_MINUTES * 60 * 1000);
    </script>
</body>
</html>
